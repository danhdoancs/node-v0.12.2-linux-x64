var http = require('http');
var through = require('through2');

var server = http.createServer(function(req,res){
    if(req.method != 'POST')
        res.end('404');

    req.pipe(through(write,end)).pipe(res);   
});
server.listen(parseInt(process.argv[2]));

var wsk = require('websocket-stream');
var wss = wsk.createServer({server:server}, handle);

function handle(stream) {
    stream.pipe(through(write,end)).pipe(stream);
}

function write(buf, _, next) {
    this.push(buf.toString().toUpperCase());
    next();
}

function end(done) {
    done();
}
